insert into S_MADRID_BRAND_ENTER_CHINA 
       select * from S_MADRID_BRAND_ENTER_CHINA_A e where e.import_session_id 
       in
(
select s.session_id from import_session s 
where 
s.batch_id in 
(
'0ef9b350-8375-4e59-8a60-2b4c3ff38931','d9cb4661-4092-4ab5-a618-633d9860666f','c5dbdc98-89b9-4cce-ac5a-4e780ec7e9d8','eaa71e42-5d1f-4210-94b8-fd0bd5036a2f','6c9ffa07-0e49-4ad5-8318-9ce9ccbf5ec9','5a25208d-9ccd-4623-8cf0-f4e9d9c50fbf','9fb2d412-cd65-4612-85be-27c7c90af47c','c9881e54-7603-4076-b402-6728acc0024b','4e7fd6ce-c32d-465f-b5fd-af0a618b895b','9e26d459-aeb7-44cf-a196-3c40a5138c37','55ae7139-bfba-485b-aa09-8021848d3e23','2c57045f-49f8-4102-a34c-3cdb3b165d56')
)  
;
commit;


select count(*) from S_MADRID_BRAND_ENTER_CHINA;
select count(*) from S_MADRID_BRAND_ENTER_CHINA_A;


















S_MADRID_BRAND_ENTER_CHINA


S_MADRID_BRAND_ENTER_CHINA_A

truncate table S_MADRID_BRAND_ENTER_CHINA;



























select * from s_import_bath b
where b.id
in
(
select b.id from S_MADRID_BRAND_ENTER_CHINA t left join import_session s on t.import_session_id = s.session_id left join s_import_bath b on s.batch_id = b.id
)


select * from import_session s where s.batch_id 
in 
(
  select b.id from S_MADRID_BRAND_ENTER_CHINA t left join import_session s on t.import_session_id = s.session_id left join s_import_bath b on s.batch_id = b.id
)





select * from s_import_bath b where b.res_type = '马德里商标进入中国' order by b.dir_path;


59ff474d-4f0d-4354-a942-91225caa75b4
0ef9b350-8375-4e59-8a60-2b4c3ff38931

select * from S_MADRID_BRAND_ENTER_CHINA e where e.import_session_id 
in
(
select s.session_id from import_session s 
where 
s.batch_id = '0ef9b350-8375-4e59-8a60-2b4c3ff38931'
) 


select * from S_MADRID_BRAND_ENTER_CHINA x
where
x.mark_cn_id
in
(
select e.mark_cn_id from S_MADRID_BRAND_ENTER_CHINA_A e where e.import_session_id 
in
(
select s.session_id from import_session s 
where 
s.batch_id = '0ef9b350-8375-4e59-8a60-2b4c3ff38931'
)
) 




select e.mark_cn_id from S_MADRID_BRAND_ENTER_CHINA e where e.import_session_id 
in
(
select s.session_id from import_session s 
where 
s.batch_id = '0ef9b350-8375-4e59-8a60-2b4c3ff38931'
)





select a.mark_cn_id, b.mark_cn_id from S_MADRID_BRAND_ENTER_CHINA a
join
S_MADRID_BRAND_ENTER_CHINA_A b
on 
a.mark_cn_id = b.mark_cn_id








select * from S_MADRID_BRAND_ENTER_CHINA x
where
x.mark_cn_id
in
(
select e.mark_cn_id from S_MADRID_BRAND_ENTER_CHINA_A e where e.import_session_id 
in
(
select s.session_id from import_session s 
where 
s.batch_id = '0ef9b350-8375-4e59-8a60-2b4c3ff38931'
)
) 




























select sum(s.total_item) from import_session s 
where 
s.batch_id = '59ff474d-4f0d-4354-a942-91225caa75b4'












select * from 
(
select * from S_MADRID_BRAND_ENTER_CHINA
where 
 mark_cn_id
       in
       (
         select mark_cn_id, max(import_time)
         from 
         S_MADRID_BRAND_ENTER_CHINA 
         group by 
         mark_cn_id 
         having count(mark_cn_id) >1
         )
)
t

            


select * from
S_MADRID_BRAND_ENTER_CHINA o
where
o.id 
not in
(
select d.id from
         (select mark_cn_id, max(import_time) as import_time
         from 
         S_MADRID_BRAND_ENTER_CHINA 
         group by 
         mark_cn_id 
         having count(mark_cn_id) >1
         order by mark_cn_id) t
         left join S_MADRID_BRAND_ENTER_CHINA d
         on t.mark_cn_id = d.mark_cn_id and d.import_time = t.import_time
         )
order by o.mark_cn_id















         (select mark_cn_id, max(import_time)
         from 
         S_MADRID_BRAND_ENTER_CHINA 
         group by 
         mark_cn_id 
         having count(mark_cn_id) >1)

select * from S_MADRID_BRAND_ENTER_CHINA where 









select * from S_MADRID_BRAND_ENTER_CHINA_A
where 
 mark_cn_id 
 in 
       (
         select mark_cn_id 
         from 
         S_MADRID_BRAND_ENTER_CHINA 
         group by 
         mark_cn_id 
         having count(mark_cn_id) >1
         )
order by import_time;         




drop table zcgdebug;
commit;



select count(distinct t.mark_cn_id) from S_MADRID_BRAND_ENTER_CHINA t;
620070

select count(distinct t.mark_cn_id) from S_MADRID_BRAND_ENTER_CHINA_A t;
620070

select count(*) from S_MADRID_BRAND_ENTER_CHINA t;
select count(*) from S_MADRID_BRAND_ENTER_CHINA_A t;



















select count(distinct mark_cn_id) from
S_MADRID_BRAND_ENTER_CHINA o
where
o.id 
not in
(
select d.id from
         (select mark_cn_id, max(import_time) as import_time
         from 
         S_MADRID_BRAND_ENTER_CHINA 
         group by 
         mark_cn_id 
         having count(mark_cn_id) >1
         ) t
         left join S_MADRID_BRAND_ENTER_CHINA d
         on t.mark_cn_id = d.mark_cn_id and d.import_time = t.import_time
union
select d.id from
       (
         (select mark_cn_id, max(import_time) as import_time
         from 
         S_MADRID_BRAND_ENTER_CHINA 
         group by 
         mark_cn_id 
         having count(mark_cn_id) = 1
         ) t
         left join S_MADRID_BRAND_ENTER_CHINA d
         on t.mark_cn_id = d.mark_cn_id and d.import_time = t.import_time
         )       
)         



select * from S_MADRID_BRAND_ENTER_CHINA
where 
 mark_cn_id 
 in 
       (
         select mark_cn_id 
         from 
         S_MADRID_BRAND_ENTER_CHINA 
         group by 
         mark_cn_id 
         having count(mark_cn_id) >1
         ))     
 and 
 import_time
 not in 
       (
       select max(import_time) 
       from 
       S_MADRID_BRAND_ENTER_CHINA 
       group by 
       mark_cn_id 
       having count(mark_cn_id) >1)
        
order by d.mark_cn_id;





select * from S_MADRID_BRAND_ENTER_CHINA d 
where 
 d.mark_cn_id 
 in 
       (
         select mark_cn_id 
         from 
         S_MADRID_BRAND_ENTER_CHINA 
         group by 
         mark_cn_id,import_time 
         having count(*) >1
         ) 
       
       
       
       
       
       


select * from S_MADRID_BRAND_ENTER_CHINA d where d.mark_cn_id in     (select t.mark_cn_id from S_MADRID_BRAND_ENTER_CHINA t where t.mark_cn_id in(select c.mark_cn_id from S_MADRID_BRAND_ENTER_CHINA c group by c.mark_cn_id having count(c.mark_cn_id) >1)) order by d.mark_cn_id;
select * from S_MADRID_BRAND_ENTER_CHINA d where d.mark_cn_id not in (select t.mark_cn_id from S_MADRID_BRAND_ENTER_CHINA t where t.import_time not in (select max(c.import_time) from S_MADRID_BRAND_ENTER_CHINA c group by c.mark_cn_id having count(c.mark_cn_id) >1)) order by d.mark_cn_id;

CN00000G13010303
select * from S_MADRID_BRAND_ENTER_CHINA d where d.mark_cn_id = 'CN00000G13010303' and d.mark_cn_id not in (select t.mark_cn_id from S_MADRID_BRAND_ENTER_CHINA t where t.import_time not in (select max(c.import_time) from S_MADRID_BRAND_ENTER_CHINA c group by c.mark_cn_id having count(c.mark_cn_id) >1));
